{% extends 'catalog/base.html' %}

{% block title %}–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É - –ú–æ—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞{% endblock %}

{% block content %}
<div class="content-card" style="max-width: 800px; margin: 0 auto;">
    <a href="{% url 'book_list' %}" class="back-button">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</a>
    
    <h2 class="page-title">üìö –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–Ω–∏–≥—É</h2>
    <p class="page-subtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–Ω–∏–≥–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É</p>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" id="book-form">
        {% csrf_token %}
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="form-section">
            <h3 class="section-title">üìñ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="{{ form.title.id_for_label }}" class="form-label">
                        –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ *
                    </label>
                    <input type="text" name="title" id="id_title" class="form-input" 
                           value="{{ form.title.value|default:'' }}" required
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏">
                    {% if form.title.errors %}
                    <div class="error-message">{{ form.title.errors }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.author.id_for_label }}" class="form-label">
                        –ê–≤—Ç–æ—Ä *
                    </label>
                    <select name="author" id="id_author" class="form-input" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ—Ä–∞</option>
                        {% for author in form.author.field.queryset %}
                            <option value="{{ author.id }}" 
                                    {% if form.author.value == author.id %}selected{% endif %}>
                                {{ author.name }}
                            </option>
                        {% endfor %}
                    </select>
                    {% if form.author.errors %}
                    <div class="error-message">{{ form.author.errors }}</div>
                    {% endif %}
                    <div class="form-help">
                        –ù–µ—Ç –Ω—É–∂–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞? <a href="{% url 'create_author' %}" class="help-link">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∞–≤—Ç–æ—Ä–∞</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ñ–∞–Ω—Ä—ã -->
        <div class="form-section">
            <h3 class="section-title">üè∑Ô∏è –ñ–∞–Ω—Ä—ã</h3>
            <div class="form-group">
                <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –∂–∞–Ω—Ä—ã *</label>
                <div class="genres-grid">
                    {% for genre in form.genres.field.queryset %}
                    <label class="genre-checkbox">
                        <input type="checkbox" name="genres" value="{{ genre.id }}" 
                               {% if genre.id in form.genres.value %}checked{% endif %}>
                        <span class="genre-label">{{ genre.name }}</span>
                    </label>
                    {% endfor %}
                </div>
                {% if form.genres.errors %}
                <div class="error-message">{{ form.genres.errors }}</div>
                {% endif %}
            </div>
        </div>

        <!-- –î–µ—Ç–∞–ª–∏ –∫–Ω–∏–≥–∏ -->
        <div class="form-section">
            <h3 class="section-title">üìã –î–µ—Ç–∞–ª–∏ –∫–Ω–∏–≥–∏</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="{{ form.publication_year.id_for_label }}" class="form-label">
                        –ì–æ–¥ –∏–∑–¥–∞–Ω–∏—è *
                    </label>
                    <input type="number" name="publication_year" id="id_publication_year" 
                           class="form-input" value="{{ form.publication_year.value|default:'' }}"
                           min="1000" max="2030" required placeholder="2024">
                    {% if form.publication_year.errors %}
                    <div class="error-message">{{ form.publication_year.errors }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.pages.id_for_label }}" class="form-label">
                        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
                    </label>
                    <input type="number" name="pages" id="id_pages" class="form-input"
                           value="{{ form.pages.value|default:'' }}" min="1" placeholder="300">
                    {% if form.pages.errors %}
                    <div class="error-message">{{ form.pages.errors }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.isbn.id_for_label }}" class="form-label">
                        ISBN
                    </label>
                    <input type="text" name="isbn" id="id_isbn" class="form-input"
                           value="{{ form.isbn.value|default:'' }}" placeholder="978-5-XXX-XXXXX-X">
                    {% if form.isbn.errors %}
                    <div class="error-message">{{ form.isbn.errors }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- –û–±–ª–æ–∂–∫–∞ -->
        <div class="form-section">
            <h3 class="section-title">üñºÔ∏è –û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏</h3>
            <div class="form-group">
                <label for="{{ form.cover.id_for_label }}" class="form-label">
                    –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±–ª–æ–∂–∫—É
                </label>
                <div class="file-upload">
                    <input type="file" name="cover" id="id_cover" class="form-input" 
                           accept="image/*">
                </div>
                {% if form.cover.errors %}
                <div class="error-message">{{ form.cover.errors }}</div>
                {% endif %}
                <div class="form-help">
                    –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 300x400px. –§–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF
                </div>
            </div>
        </div>

        <!-- –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è -->
        <div class="form-section">
            <h3 class="section-title">üìù –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è</h3>
            <div class="form-group">
                <label for="{{ form.annotation.id_for_label }}" class="form-label">
                    –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –∫–Ω–∏–≥–∏ *
                </label>
                <textarea name="annotation" id="id_annotation" class="form-textarea" 
                          required placeholder="–û–ø–∏—à–∏—Ç–µ —Å—é–∂–µ—Ç –∏–ª–∏ –æ—Å–Ω–æ–≤–Ω—É—é –∏–¥–µ—é –∫–Ω–∏–≥–∏...">{{ form.annotation.value|default:'' }}</textarea>
                {% if form.annotation.errors %}
                <div class="error-message">{{ form.annotation.errors }}</div>
                {% endif %}
                <div class="form-help">
                    –û–ø–∏—à–∏—Ç–µ —Å—é–∂–µ—Ç –∏–ª–∏ –æ—Å–Ω–æ–≤–Ω—É—é –∏–¥–µ—é –∫–Ω–∏–≥–∏
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large">
                ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É
            </button>
            <a href="{% url 'book_list' %}" class="btn btn-secondary">
                ‚ùå –û—Ç–º–µ–Ω–∞
            </a>
        </div>
    </form>
</div>

<style>
    .form-section {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 25px;
        border-left: 4px solid #667eea;
    }

    .section-title {
        font-size: 1.3em;
        color: #2c3e50;
        margin-bottom: 20px;
        font-weight: 600;
        border-bottom: 2px solid #f8f9fa;
        padding-bottom: 10px;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        display: block;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 8px;
        font-size: 0.95em;
    }

    .form-help {
        font-size: 0.85em;
        color: #6c757d;
        margin-top: 5px;
    }

    .help-link {
        color: #667eea;
        text-decoration: none;
    }

    .help-link:hover {
        text-decoration: underline;
    }

    .error-message {
        color: #dc3545;
        font-size: 0.85em;
        margin-top: 5px;
        padding: 5px 10px;
        background: #fee;
        border-radius: 5px;
        border-left: 3px solid #dc3545;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ */
    .form-input,
    .form-textarea,
    select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 1em;
        transition: all 0.3s ease;
        background: white;
        font-family: inherit;
    }

    .form-input:focus,
    .form-textarea:focus,
    select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-textarea {
        resize: vertical;
        min-height: 120px;
        line-height: 1.5;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ –∂–∞–Ω—Ä–æ–≤ */
    .genres-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        margin-top: 10px;
    }

    .genre-checkbox {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        background: #f8f9fa;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .genre-checkbox:hover {
        background: #e9ecef;
        border-color: #667eea;
    }

    .genre-checkbox input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.2);
    }

    .genre-label {
        font-weight: 500;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ */
    .file-upload input[type="file"] {
        padding: 10px;
        background: #f8f9fa;
        border: 2px dashed #dee2e6;
    }

    .file-upload input[type="file"]:hover {
        border-color: #667eea;
        background: #f0f2ff;
    }

    /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
    .form-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 30px;
        padding-top: 25px;
        border-top: 2px solid #f8f9fa;
    }

    .btn-large {
        padding: 15px 30px;
        font-size: 1.1em;
    }

    .btn {
        padding: 12px 25px;
        border: none;
        border-radius: 10px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
    }

    .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
    }

    /* –°–æ–æ–±—â–µ–Ω–∏—è */
    .alert {
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid;
    }

    .alert-success {
        background: #f0fff4;
        border-color: #28a745;
        color: #155724;
    }

    .alert-error {
        background: #fee;
        border-color: #dc3545;
        color: #721c24;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
        }
        
        .genres-grid {
            grid-template-columns: 1fr;
        }
        
        .form-actions {
            flex-direction: column;
        }
        
        .btn {
            width: 100%;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –≥–æ–¥–∞ –∏–∑–¥–∞–Ω–∏—è
        const yearInput = document.querySelector('#id_publication_year');
        if (yearInput) {
            yearInput.addEventListener('blur', function() {
                const year = parseInt(this.value);
                if (year && (year < 1000 || year > 2030)) {
                    this.style.borderColor = '#dc3545';
                    this.style.background = '#fee';
                } else {
                    this.style.borderColor = '#28a745';
                    this.style.background = '#f9fff9';
                }
            });
        }

        // –ü–æ–¥—Å—á–µ—Ç —Å–∏–º–≤–æ–ª–æ–≤ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏
        const annotationTextarea = document.querySelector('#id_annotation');
        if (annotationTextarea) {
            const counter = document.createElement('div');
            counter.className = 'form-help';
            counter.style.textAlign = 'right';
            counter.textContent = `–°–∏–º–≤–æ–ª–æ–≤: ${annotationTextarea.value.length}`;
            annotationTextarea.parentNode.appendChild(counter);

            annotationTextarea.addEventListener('input', function() {
                counter.textContent = `–°–∏–º–≤–æ–ª–æ–≤: ${this.value.length}`;
            });
        }
    });
</script>
{% endblock %}